<script type="text/javascript" charset="utf-8">
  var planning_apps = <%= @planning_applications.to_json %>;
  var loc = <%= @postcode ? @postcode.to_json : false %>;
  
  function initMap() {
    if (GBrowserIsCompatible()) {
      var map = new GMap2(document.getElementById("map_canvas"));
      var center = new GLatLng(loc.lat, loc.lng);
      map.setCenter(center, 6); //set default centre
      
      var first_view = true;
      var bounds = new GLatLngBounds(); //set bounding area
      map.addControl(new GSmallMapControl());
      map.addControl(new GMapTypeControl());
      for (var i=0; i < planning_apps.length; i++) {
        var pa = planning_apps[i].planning_application
        var m = createMarker(pa, map, planningAppCaption(pa));
        map.addOverlay(m);
        bounds.extend(m.getLatLng());
      };
      if(loc){
        map.setZoom(map.getBoundsZoomLevel(bounds));
        map.setCenter(bounds.getCenter());
      };
    }
  }
  
</script>
<h1><%= @title %></h1>
<div id="planning_applications_map" class="map_outer">
  <div id="map_canvas"></div>
</div>

<%= list_all @planning_applications %>


<%= render :partial => '/shared/api_info' %>
